<?php


session_start();
header('Content-Type: application/json');
include __DIR__ . '../includes/connection.php';

try 
{
    // Get current draft order from active_users joined with users
    $sql = "SELECT u.gamerTag 
            FROM active_users au
            JOIN users u ON au.user_id = u.id
            WHERE au.draft_pick IS NOT NULL
            ORDER BY au.draft_pick ASC";
    $result = $conn->query($sql);
    if (!$result) throw new Exception("Error fetching draft order: " . $conn->error);

    $order = [];

    while ($row = $result->fetch_assoc()) 
        {
            $order[] = $row['gamerTag'];
        }

    echo json_encode($order);
} 

    catch (Exception $e) {
    echo json_encode(['error' => $e->getMessage()]);
}